#!/usr/bin/env python3"""Financial Analyzer Pro - Main Entry PointDeveloper: Seyed Aladdin Mousavi JashniGitHub: seiedalaedin/financial-analyzer-pro"""
import asyncioimport loggingimport sysfrom datetime import datetime
from src.core.crisis_analyzer import CrisisAnalyzerfrom src.core.monte_carlo import MonteCarloEnginefrom src.core.signal_generator import SignalGeneratorfrom src.data.market_data import MarketDataManagerfrom src.utils.logger import setup_loggingfrom config import config
class FinancialAnalyzerPro:    """کلاس اصلی سیستم تحلیل مالی"""        def __init__(self):        self.logger = setup_logging(__name__)        self.crisis_analyzer = CrisisAnalyzer()        self.monte_carlo = MonteCarloEngine()        self.signal_generator = SignalGenerator()        self.market_data = MarketDataManager()                self.startup_time = datetime.now()        self.is_running = False            async def initialize(self):        """مقداردهی اولیه سیستم"""        try:            self.logger.info(" Starting Financial Analyzer Pro...")            self.logger.info(f" Version: {config.VERSION}")            self.logger.info(f" Developer: {config.DEVELOPER}")                        # مقداردهی ماژول‌ها            await self.market_data.initialize()            await self.crisis_analyzer.initialize()            await self.monte_carlo.initialize()                        self.is_running = True            self.logger.info(" System initialized successfully!")                    except Exception as e:            self.logger.error(f" Initialization failed: {e}")            raise        async def analyze_markets(self):        """آنالیز جامع بازارهای مالی"""        if not self.is_running:            await self.initialize()                    try:            # دریافت داده‌های بازار            market_data = await self.market_data.get_all_market_data()                        # تحلیل بحران            crisis_report = await self.crisis_analyzer.analyze(market_data)                        # شبیه‌سازی مونت کارلو            risk_assessment = await self.monte_carlo.analyze_portfolio_risk(market_data)                        # تولید سیگنال            trading_signals = await self.signal_generator.generate_signals(market_data)                        return {                "timestamp": datetime.now().isoformat(),                "crisis_analysis": crisis_report,                "risk_assessment": risk_assessment,                "trading_signals": trading_signals,                "market_condition": self._determine_market_condition(crisis_report, risk_assessment)            }                    except Exception as e:            self.logger.error(f" Market analysis failed: {e}")            return None        def _determine_market_condition(self, crisis_report, risk_assessment):        """تعیین وضعیت کلی بازار"""        crisis_score = crisis_report.get('crisis_score', 0)        var_95 = risk_assessment.get('var_95', 0)                if crisis_score > 0.7 or var_95 < -0.1:            return "CRISIS"        elif crisis_score > 0.4 or var_95 < -0.05:            return "HIGH_RISK"        elif crisis_score > 0.2:            return "MODERATE_RISK"        else:            return "NORMAL"        async def shutdown(self):        """خاموش کردن سیستم"""        self.is_running = False        self.logger.info(" Shutting down Financial Analyzer Pro...")        await self.market_data.cleanup()
async def main():    """تابع اصلی اجرا"""    analyzer = FinancialAnalyzerPro()        try:        await analyzer.initialize()                # اجرای تحلیل اولیه        results = await analyzer.analyze_markets()                if results:            print("\n" + "="*50)            print(" FINANCIAL ANALYZER PRO - ANALYSIS RESULTS")            print("="*50)            print(f" Timestamp: {results['timestamp']}")            print(f" Market Condition: {results['market_condition']}")            print(f" Crisis Score: {results['crisis_analysis'].get('crisis_score', 'N/A')}")            print(f" VaR 95%: {results['risk_assessment'].get('var_95', 'N/A')}")            print(f" Signals Generated: {len(results['trading_signals'])}")            print("="*50)                        return results        else:            print(" Analysis failed!")            return None                except Exception as e:        print(f" Critical error: {e}")        return None        finally:        await analyzer.shutdown()
if __name__ == "__main__":    # اجرای سیستم    try:        results = asyncio.run(main())        if results:            sys.exit(0)        else:            sys.exit(1)    except KeyboardInterrupt:        print("\n System stopped by user")        sys.exit(0)
